{% extends "base.html" %}

{% block title %}Add Phase - Operation Bella Ciao{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1 class="display-4"><i class="bi bi-plus-circle-fill"></i> Add New Phase</h1>
        <p class="lead">Define a new phase in the heist plan</p>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <form method="POST" action="/phases/add">
                        <!-- REMOVED Phase ID field - now auto-generated -->
                        
                        <div class="mb-3">
                            <label for="codename" class="form-label">Phase Codename *</label>
                            <input type="text" class="form-control" id="codename" name="codename" 
                                   placeholder="e.g., Infiltration, Escape, Diversion" required>
                        </div>

                        <div class="mb-3">
                            <label for="duration" class="form-label">Planned Duration (hours) *</label>
                            <input type="number" class="form-control" id="duration" name="duration" 
                                   min="1" value="4" required>
                            <small class="text-muted">Estimated time to complete this phase</small>
                        </div>

                        <div class="mb-3">
                            <label for="dissonance" class="form-label">Initial Dissonance (0-30)</label>
                            <input type="number" class="form-control" id="dissonance" name="dissonance" 
                                   min="0" max="30" value="0">
                            <small class="text-muted">Risk level - 0 = no issues, 30 = maximum risk</small>
                            <div class="progress mt-2" style="height: 25px;">
                                <div id="dissonance-bar" class="progress-bar bg-success" style="width: 0%">
                                    Low Risk
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> 
                            <strong>Auto-Generated ID:</strong> Phase ID will be automatically assigned by the system.
                            <br>
                            <strong>Next Steps:</strong> After creating the phase, you can assign crew members 
                            and resources through the main phases page.
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success">
                                <i class="bi bi-check-circle"></i> Add Phase
                            </button>
                            <a href="/phases" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Update dissonance bar
document.getElementById('dissonance').addEventListener('input', function() {
    const value = parseInt(this.value);
    const bar = document.getElementById('dissonance-bar');
    const percentage = (value / 30) * 100;
    bar.style.width = percentage + '%';
    
    if (value >= 20) {
        bar.className = 'progress-bar bg-danger';
        bar.textContent = 'High Risk';
    } else if (value >= 10) {
        bar.className = 'progress-bar bg-warning';
        bar.textContent = 'Moderate Risk';
    } else if (value > 0) {
        bar.className = 'progress-bar bg-info';
        bar.textContent = 'Low Risk';
    } else {
        bar.className = 'progress-bar bg-success';
        bar.textContent = 'On Track';
    }
});
</script>
{% endblock %}
